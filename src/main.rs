use std::{cmp::min};
use std::io::Read;
use npy::NpyData;


static DELTA_POS: [(i32, i32); 44] = 
    [(-1, 0), (1, 0), (0, -1), (0, 1),  // 0..3 group 1
     (-1, -1), (1, -1), (-1, 1), (1, 1), // 4..7 group 2
     (-2, 0), (2, 0), (0, -2), (0, 2),   // 8..11
     (-2, 1), (-1, 2), (1, 2), (2, 1), (2, -1), (1, -2), (-1, -2), (-2, -1), // 12..19
     (-2, 2), (2, 2), (2, -2), (-2, -2), // 20..23
     (-3, 0), (0, 3), (3, 0), (0, -3),   // 24..27
     (-3, 1), (-1, 3), (1, 3), (3, 1), (3, -1), (1, -3), (-1, -3), (-3, -1), // 28..35
     (-3, -2), (3, -2), (-3, 2), (3, 2), (-2, -3), (2, -3), (-2, 3), (2, 3)] // 36..43
    ; // Gruppen von Nachbarschaften f√ºr Abstand <4       ;

const XYDIM: usize = 256;
static MAX_DIST_TOF:f64 = 50.;


fn get_labels() -> Vec<i32> {
    let data = 
       [
        [122.        , 146.        ,   2.34770714,   9.        ],
        [151.        , 211.        ,   2.23914692, 180.        ],
        [151.        , 212.        ,   2.24135676, 148.        ],
        [151.        , 213.        ,   2.24457545, 105.        ],
        [151.        , 214.        ,   2.25173231,  66.        ],
        [151.        , 215.        ,   2.32529233,  14.        ],
        [151.        , 216.        ,   2.36663971,   5.        ],
        [151.        , 217.        ,   2.38453617,   1.        ],
        [152.        , 205.        ,   2.38026529,   2.        ],
        [151.        , 210.        ,   2.23673524, 238.        ],
        [152.        , 206.        ,   2.35716229,   7.        ],
        [152.        , 208.        ,   2.26071141,  43.        ],
        [152.        , 209.        ,   2.24766822,  85.        ],
        [152.        , 210.        ,   2.24435952, 107.        ],
        [152.        , 211.        ,   2.24561211,  97.        ],
        [152.        , 212.        ,   2.24825931,  82.        ],
        [152.        , 213.        ,   2.25930764,  45.        ],
        [152.        , 214.        ,   2.29934514,  21.        ],
        [152.        , 215.        ,   2.33397398,  12.        ],
        [152.        , 207.        ,   2.29050491,  24.        ],
        [151.        , 209.        ,   2.23973456, 170.        ],
        [151.        , 208.        ,   2.24405962, 110.        ],
        [151.        , 207.        ,   2.26522413,  38.        ],
        [149.        , 216.        ,   2.30267409,  20.        ],
        [150.        , 204.        ,   2.38453617,   1.        ],
        [150.        , 205.        ,   2.34303365,  10.        ],
        [150.        , 206.        ,   2.25930764,  45.        ],
        [150.        , 207.        ,   2.24674396,  90.        ],
        [150.        , 208.        ,   2.23909576, 181.        ],
        [150.        , 209.        ,   2.23545751, 278.        ],
        [150.        , 210.        ,   2.2326663 , 366.        ],
        [150.        , 211.        ,   2.23295176, 357.        ],
        [150.        , 212.        ,   2.23555266, 275.        ],
        [150.        , 213.        ,   2.24015129, 164.        ],
        [150.        , 214.        ,   2.24766822,  85.        ],
        [150.        , 215.        ,   2.26882824,  35.        ],
        [150.        , 216.        ,   2.34303365,  10.        ],
        [150.        , 217.        ,   2.37595717,   3.        ],
        [151.        , 203.        ,   2.38453617,   1.        ],
        [151.        , 204.        ,   2.38453617,   1.        ],
        [151.        , 205.        ,   2.3523949 ,   8.        ],
        [151.        , 206.        ,   2.29338776,  23.        ],
        [152.        , 216.        ,   2.38453617,   1.        ],
        [149.        , 215.        ,   2.27020477,  34.        ],
        [153.        , 205.        ,   2.38453617,   1.        ],
        [153.        , 207.        ,   2.33397398,  12.        ],
        [155.        , 210.        ,   2.38026529,   2.        ],
        [155.        , 212.        ,   2.37595717,   3.        ],
        [155.        , 213.        ,   2.38453617,   1.        ],
        [155.        , 216.        ,   2.38453617,   1.        ],
        [156.        , 207.        ,   2.38453617,   1.        ],
        [156.        , 208.        ,   2.38453617,   1.        ],
        [156.        , 209.        ,   2.38453617,   1.        ],
        [142.        , 214.        ,   2.38453617,   1.        ],
        [155.        , 209.        ,   2.38026529,   2.        ],
        [142.        , 213.        ,   2.37595717,   3.        ],
        [142.        , 211.        ,   2.37595717,   3.        ],
        [142.        , 210.        ,   2.38026529,   2.        ],
        [142.        , 209.        ,   2.38026529,   2.        ],
        [142.        , 208.        ,   2.36663971,   5.        ],
        [142.        , 207.        ,   2.38453617,   1.        ],
        [141.        , 214.        ,   2.38453617,   1.        ],
        [141.        , 210.        ,   2.38026529,   2.        ],
        [141.        , 207.        ,   2.38453617,   1.        ],
        [142.        , 212.        ,   2.38026529,   2.        ],
        [155.        , 208.        ,   2.38453617,   1.        ],
        [155.        , 207.        ,   2.38026529,   2.        ],
        [155.        , 206.        ,   2.38453617,   1.        ],
        [153.        , 208.        ,   2.32118001,  15.        ],
        [153.        , 209.        ,   2.2600025 ,  44.        ],
        [153.        , 210.        ,   2.2614612 ,  42.        ],
        [153.        , 211.        ,   2.26417267,  39.        ],
        [153.        , 212.        ,   2.28544017,  26.        ],
        [153.        , 213.        ,   2.31332605,  17.        ],
        [153.        , 214.        ,   2.34303365,  10.        ],
        [153.        , 215.        ,   2.36192969,   6.        ],
        [153.        , 216.        ,   2.38453617,   1.        ],
        [153.        , 218.        ,   2.38453617,   1.        ],
        [154.        , 208.        ,   2.35716229,   7.        ],
        [154.        , 209.        ,   2.35716229,   7.        ],
        [154.        , 210.        ,   2.34303365,  10.        ],
        [154.        , 211.        ,   2.31706769,  16.        ],
        [154.        , 212.        ,   2.34770714,   9.        ],
        [154.        , 213.        ,   2.36192969,   6.        ],
        [154.        , 214.        ,   2.37595717,   3.        ],
        [154.        , 215.        ,   2.38453617,   1.        ],
        [154.        , 216.        ,   2.38453617,   1.        ],
        [153.        , 206.        ,   2.36663971,   5.        ],
        [149.        , 214.        ,   2.24457545, 105.        ],
        [149.        , 213.        ,   2.23781175, 216.        ],
        [149.        , 212.        ,   2.23409362, 321.        ],
        [145.        , 207.        ,   2.30267409,  20.        ],
        [145.        , 208.        ,   2.26232499,  41.        ],
        [145.        , 209.        ,   2.24692156,  89.        ],
        [145.        , 210.        ,   2.2439667 , 111.        ],
        [145.        , 211.        ,   2.24405962, 110.        ],
        [145.        , 212.        ,   2.24950647,  76.        ],
        [145.        , 213.        ,   2.25506915,  54.        ],
        [145.        , 214.        ,   2.31332605,  17.        ],
        [145.        , 206.        ,   2.37129844,   4.        ],
        [145.        , 215.        ,   2.32529233,  14.        ],
        [146.        , 203.        ,   2.38453617,   1.        ],
        [146.        , 204.        ,   2.38026529,   2.        ],
        [146.        , 205.        ,   2.37129844,   4.        ],
        [146.        , 206.        ,   2.28797254,  25.        ],
        [146.        , 207.        ,   2.25663679,  50.        ],
        [146.        , 208.        ,   2.24354524, 116.        ],
        [146.        , 209.        ,   2.23973456, 170.        ],
        [146.        , 210.        ,   2.23792962, 213.        ],
        [145.        , 216.        ,   2.38453617,   1.        ],
        [142.        , 215.        ,   2.38453617,   1.        ],
        [145.        , 205.        ,   2.38453617,   1.        ],
        [144.        , 216.        ,   2.38453617,   1.        ],
        [143.        , 208.        ,   2.36663971,   5.        ],
        [143.        , 209.        ,   2.33397398,  12.        ],
        [143.        , 210.        ,   2.36663971,   5.        ],
        [143.        , 211.        ,   2.35716229,   7.        ],
        [143.        , 212.        ,   2.33841275,  11.        ],
        [143.        , 213.        ,   2.37595717,   3.        ],
        [143.        , 214.        ,   2.38026529,   2.        ],
        [143.        , 215.        ,   2.38453617,   1.        ],
        [143.        , 216.        ,   2.38453617,   1.        ],
        [144.        , 205.        ,   2.38453617,   1.        ],
        [144.        , 206.        ,   2.37129844,   4.        ],
        [144.        , 207.        ,   2.3523949 ,   8.        ],
        [144.        , 208.        ,   2.30600304,  19.        ],
        [144.        , 209.        ,   2.27687026,  30.        ],
        [144.        , 210.        ,   2.26417267,  39.        ],
        [144.        , 211.        ,   2.25621901,  51.        ],
        [144.        , 212.        ,   2.27687026,  30.        ],
        [144.        , 213.        ,   2.31706769,  16.        ],
        [144.        , 214.        ,   2.3523949 ,   8.        ],
        [146.        , 211.        ,   2.23803901, 210.        ],
        [146.        , 212.        ,   2.2394814 , 174.        ],
        [146.        , 213.        ,   2.24506157, 101.        ],
        [146.        , 214.        ,   2.26522413,  38.        ],
        [148.        , 209.        ,   2.23307864, 353.        ],
        [148.        , 210.        ,   2.23022399, 443.        ],
        [148.        , 211.        ,   2.23063633, 430.        ],
        [148.        , 212.        ,   2.23307864, 353.        ],
        [148.        , 213.        ,   2.23606991, 254.        ],
        [148.        , 214.        ,   2.24378911, 113.        ],
        [148.        , 215.        ,   2.2600025 ,  44.        ],
        [148.        , 216.        ,   2.31332605,  17.        ],
        [148.        , 217.        ,   2.38026529,   2.        ],
        [148.        , 218.        ,   2.37595717,   3.        ],
        [149.        , 203.        ,   2.38453617,   1.        ],
        [149.        , 204.        ,   2.37595717,   3.        ],
        [149.        , 205.        ,   2.31706769,  16.        ],
        [149.        , 206.        ,   2.26627914,  37.        ],
        [149.        , 207.        ,   2.24311236, 122.        ],
        [149.        , 208.        ,   2.23785199, 215.        ],
        [149.        , 209.        ,   2.23222224, 380.        ],
        [149.        , 210.        ,   2.23047774, 435.        ],
        [149.        , 211.        ,   2.23019227, 444.        ],
        [148.        , 208.        ,   2.23772898, 218.        ],
        [122.        , 145.        ,   2.38453617,   1.        ],
        [148.        , 207.        ,   2.24561211,  97.        ],
        [148.        , 205.        ,   2.34303365,  10.        ],
        [146.        , 215.        ,   2.31706769,  16.        ],
        [146.        , 216.        ,   2.35716229,   7.        ],
        [146.        , 217.        ,   2.38026529,   2.        ],
        [147.        , 204.        ,   2.38026529,   2.        ],
        [147.        , 205.        ,   2.34770714,   9.        ],
        [147.        , 206.        ,   2.26627914,  37.        ],
        [147.        , 207.        ,   2.24747688,  86.        ],
        [147.        , 208.        ,   2.24044678, 160.        ],
        [147.        , 209.        ,   2.23597187, 258.        ],
        [147.        , 210.        ,   2.23253943, 370.        ],
        [147.        , 211.        ,   2.23415706, 319.        ],
        [147.        , 212.        ,   2.23533064, 282.        ],
        [147.        , 213.        ,   2.24067413, 157.        ],
        [147.        , 214.        ,   2.24866755,  80.        ],
        [147.        , 215.        ,   2.26627914,  37.        ],
        [147.        , 216.        ,   2.37595717,   3.        ],
        [147.        , 217.        ,   2.37595717,   3.        ],
        [147.        , 218.        ,   2.38453617,   1.        ],
        [148.        , 204.        ,   2.37595717,   3.        ],
        [148.        , 206.        ,   2.26627914,  37.        ],
        [143.        , 207.        ,   2.37129844,   4.        ],
        [143.        , 205.        ,   2.38026529,   2.        ],
        [124.        , 157.        ,   2.35716229,   7.        ],
        [118.        , 153.        ,   2.27173955,  33.        ],
        [124.        , 156.        ,   2.29338776,  23.        ],
        [124.        , 155.        ,   2.25081897,  70.        ],
        [124.        , 154.        ,   2.2427192 , 128.        ],
        [124.        , 153.        ,   2.23588858, 263.        ],
        [124.        , 152.        ,   2.23450596, 308.        ],
        [124.        , 151.        ,   2.23466455, 303.        ],
        [124.        , 150.        ,   2.23555266, 275.        ],
        [124.        , 158.        ,   2.37595717,   3.        ],
        [124.        , 149.        ,   2.24193146, 140.        ],
        [124.        , 147.        ,   2.28308352,  27.        ],
        [124.        , 146.        ,   2.33841275,  11.        ],
        [124.        , 145.        ,   2.37129844,   4.        ],
        [124.        , 144.        ,   2.38026529,   2.        ],
        [123.        , 159.        ,   2.38453617,   1.        ],
        [123.        , 158.        ,   2.37595717,   3.        ],
        [123.        , 157.        ,   2.35716229,   7.        ],
        [123.        , 156.        ,   2.27020477,  34.        ],
        [124.        , 148.        ,   2.24710412,  88.        ],
        [123.        , 155.        ,   2.24561211,  97.        ],
        [125.        , 144.        ,   2.38453617,   1.        ],
        [125.        , 146.        ,   2.37595717,   3.        ],
        [126.        , 150.        ,   2.25296474,  61.        ],
        [126.        , 149.        ,   2.25930764,  45.        ],
        [126.        , 148.        ,   2.29934514,  21.        ],
        [126.        , 147.        ,   2.34303365,  10.        ],
        [126.        , 146.        ,   2.37595717,   3.        ],
        [125.        , 159.        ,   2.38453617,   1.        ],
        [125.        , 158.        ,   2.37129844,   4.        ],
        [125.        , 157.        ,   2.37129844,   4.        ],
        [125.        , 145.        ,   2.38026529,   2.        ],
        [125.        , 156.        ,   2.31332605,  17.        ],
        [125.        , 154.        ,   2.24786144,  84.        ],
        [125.        , 153.        ,   2.24113137, 151.        ],
        [125.        , 152.        ,   2.23980115, 169.        ],
        [125.        , 151.        ,   2.23874385, 189.        ],
        [125.        , 150.        ,   2.24200027, 139.        ],
        [125.        , 149.        ,   2.24747688,  86.        ],
        [125.        , 148.        ,   2.26232499,  41.        ],
        [125.        , 147.        ,   2.32529233,  14.        ],
        [125.        , 155.        ,   2.25663679,  50.        ],
        [123.        , 154.        ,   2.23886606, 186.        ],
        [123.        , 153.        ,   2.2333641 , 344.        ],
        [123.        , 152.        ,   2.23171475, 396.        ],
        [116.        , 153.        ,   2.38026529,   2.        ],
        [116.        , 154.        ,   2.38453617,   1.        ],
        [116.        , 155.        ,   2.38453617,   1.        ],
        [117.        , 146.        ,   2.38453617,   1.        ],
        [117.        , 148.        ,   2.38026529,   2.        ],
        [117.        , 149.        ,   2.36663971,   5.        ],
        [117.        , 150.        ,   2.35716229,   7.        ],
        [117.        , 151.        ,   2.33841275,  11.        ],
        [116.        , 152.        ,   2.38453617,   1.        ],
        [117.        , 152.        ,   2.34770714,   9.        ],
        [117.        , 154.        ,   2.38026529,   2.        ],
        [117.        , 155.        ,   2.37595717,   3.        ],
        [118.        , 143.        ,   2.38453617,   1.        ],
        [118.        , 145.        ,   2.38453617,   1.        ],
        [118.        , 147.        ,   2.37595717,   3.        ],
        [118.        , 148.        ,   2.31332605,  17.        ],
        [118.        , 149.        ,   2.30600304,  19.        ],
        [118.        , 150.        ,   2.28797254,  25.        ],
        [117.        , 153.        ,   2.37129844,   4.        ],
        [116.        , 151.        ,   2.36192969,   6.        ],
        [116.        , 150.        ,   2.38026529,   2.        ],
        [115.        , 153.        ,   2.38453617,   1.        ],
        [123.        , 151.        ,   2.23184162, 392.        ],
        [123.        , 150.        ,   2.23390331, 327.        ],
        [123.        , 149.        ,   2.23836653, 200.        ],
        [123.        , 148.        ,   2.24692156,  89.        ],
        [123.        , 147.        ,   2.26318879,  40.        ],
        [123.        , 146.        ,   2.32953521,  13.        ],
        [122.        , 158.        ,   2.38453617,   1.        ],
        [122.        , 157.        ,   2.35716229,   7.        ],
        [122.        , 156.        ,   2.27020477,  34.        ],
        [122.        , 155.        ,   2.24506157, 101.        ],
        [122.        , 154.        ,   2.23856255, 194.        ],
        [122.        , 153.        ,   2.23320551, 349.        ],
        [122.        , 152.        ,   2.23177819, 394.        ],
        [122.        , 151.        ,   2.23098523, 419.        ],
        [122.        , 150.        ,   2.23403019, 323.        ],
        [122.        , 149.        ,   2.23866892, 191.        ],
        [122.        , 148.        ,   2.24846223,  81.        ],
        [122.        , 147.        ,   2.26627914,  37.        ],
        [115.        , 150.        ,   2.38453617,   1.        ],
        [126.        , 151.        ,   2.24518965, 100.        ],
        [118.        , 151.        ,   2.28544017,  26.        ],
        [126.        , 152.        ,   2.24493348, 102.        ],
        [126.        , 154.        ,   2.26882824,  35.        ],
        [120.        , 150.        ,   2.24037204, 161.        ],
        [120.        , 149.        ,   2.2439667 , 111.        ],
        [120.        , 148.        ,   2.25872405,  46.        ],
        [120.        , 147.        ,   2.3095935 ,  18.        ],
        [120.        , 146.        ,   2.37129844,   4.        ],
        [120.        , 145.        ,   2.38453617,   1.        ],
        [119.        , 158.        ,   2.38026529,   2.        ],
        [119.        , 157.        ,   2.38026529,   2.        ],
        [120.        , 151.        ,   2.23789081, 214.        ],
        [119.        , 156.        ,   2.34770714,   9.        ],
        [119.        , 154.        ,   2.25814046,  47.        ],
        [119.        , 153.        ,   2.25081897,  70.        ],
        [119.        , 152.        ,   2.24446625, 106.        ],
        [119.        , 151.        ,   2.24728667,  87.        ],
        [119.        , 150.        ,   2.25015517,  73.        ],
        [119.        , 149.        ,   2.26232499,  41.        ],
        [119.        , 148.        ,   2.32118001,  15.        ],
        [119.        , 147.        ,   2.34303365,  10.        ],
        [119.        , 155.        ,   2.28544017,  26.        ],
        [119.        , 146.        ,   2.38453617,   1.        ],
        [120.        , 152.        ,   2.23785199, 215.        ],
        [120.        , 154.        ,   2.24446625, 106.        ],
        [121.        , 158.        ,   2.37129844,   4.        ],
        [121.        , 157.        ,   2.36663971,   5.        ],
        [121.        , 156.        ,   2.27875082,  29.        ],
        [121.        , 155.        ,   2.25037462,  72.        ],
        [121.        , 154.        ,   2.24120717, 150.        ],
        [121.        , 153.        ,   2.23587627, 264.        ],
        [121.        , 152.        ,   2.23441081, 311.        ],
        [121.        , 151.        ,   2.23447424, 309.        ],
        [120.        , 153.        ,   2.24044678, 160.        ],
        [121.        , 150.        ,   2.23583813, 266.        ],
        [121.        , 148.        ,   2.24846223,  81.        ],
        [121.        , 147.        ,   2.28091717,  28.        ],
        [121.        , 146.        ,   2.35716229,   7.        ],
        [121.        , 145.        ,   2.38026529,   2.        ],
        [120.        , 158.        ,   2.38026529,   2.        ],
        [120.        , 157.        ,   2.35716229,   7.        ],
        [120.        , 156.        ,   2.29631133,  22.        ],
        [120.        , 155.        ,   2.2614612 ,  42.        ],
        [121.        , 149.        ,   2.2399381 , 167.        ],
        [119.        , 145.        ,   2.38453617,   1.        ],
        [118.        , 157.        ,   2.38453617,   1.        ],
        [118.        , 156.        ,   2.37595717,   3.        ],
        [128.        , 148.        ,   2.37595717,   3.        ],
        [127.        , 157.        ,   2.38453617,   1.        ],
        [127.        , 156.        ,   2.38453617,   1.        ],
        [127.        , 155.        ,   2.35716229,   7.        ],
        [127.        , 154.        ,   2.30267409,  20.        ],
        [127.        , 153.        ,   2.30267409,  20.        ],
        [127.        , 152.        ,   2.26755369,  36.        ],
        [127.        , 151.        ,   2.26882824,  35.        ],
        [128.        , 149.        ,   2.37129844,   4.        ],
        [127.        , 150.        ,   2.27327432,  32.        ],
        [127.        , 148.        ,   2.35716229,   7.        ],
        [127.        , 147.        ,   2.38453617,   1.        ],
        [127.        , 145.        ,   2.38453617,   1.        ],
        [126.        , 160.        ,   2.38453617,   1.        ],
        [126.        , 158.        ,   2.38026529,   2.        ],
        [126.        , 157.        ,   2.37595717,   3.        ],
        [126.        , 156.        ,   2.37129844,   4.        ],
        [126.        , 155.        ,   2.29934514,  21.        ],
        [127.        , 149.        ,   2.30600304,  19.        ],
        [128.        , 150.        ,   2.34770714,   9.        ],
        [128.        , 151.        ,   2.34303365,  10.        ],
        [128.        , 152.        ,   2.34770714,   9.        ],
        [118.        , 155.        ,   2.38453617,   1.        ],
        [118.        , 154.        ,   2.3095935 ,  18.        ],
        [123.        , 143.        ,   2.38453617,   1.        ],
        [130.        , 154.        ,   2.37129844,   4.        ],
        [130.        , 151.        ,   2.38453617,   1.        ],
        [130.        , 150.        ,   2.38453617,   1.        ],
        [129.        , 154.        ,   2.38453617,   1.        ],
        [129.        , 153.        ,   2.37129844,   4.        ],
        [129.        , 152.        ,   2.38453617,   1.        ],
        [129.        , 151.        ,   2.38026529,   2.        ],
        [129.        , 150.        ,   2.37595717,   3.        ],
        [129.        , 149.        ,   2.38026529,   2.        ],
        [129.        , 146.        ,   2.38453617,   1.        ],
        [128.        , 158.        ,   2.38453617,   1.        ],
        [128.        , 157.        ,   2.38453617,   1.        ],
        [128.        , 156.        ,   2.38026529,   2.        ],
        [128.        , 155.        ,   2.38026529,   2.        ],
        [128.        , 154.        ,   2.38026529,   2.        ],
        [128.        , 153.        ,   2.35716229,   7.        ],
        [126.        , 153.        ,   2.24710412,  88.        ],
        [118.        , 152.        ,   2.26232499,  41.        ],
        [ 99.        , 134.        ,   2.39913777,   1.        ],
        [ 99.        , 138.        ,   2.39913777,   1.        ],
        [ 96.        , 134.        ,   2.25228675, 219.        ],
        [ 96.        , 135.        ,   2.24044847, 581.        ],
        [ 96.        , 136.        ,   2.24270046, 510.        ],
        [ 96.        , 137.        ,   2.25159735, 233.        ],
        [ 96.        , 138.        ,   2.28634115,  33.        ],
        [ 96.        , 139.        ,   2.39486689,   2.        ],
        [ 97.        , 132.        ,   2.39486689,   2.        ],
        [ 97.        , 133.        ,   2.33578161,  15.        ],
        [ 97.        , 134.        ,   2.26286091,  82.        ],
        [ 96.        , 133.        ,   2.2746041 ,  44.        ],
        [ 97.        , 135.        ,   2.25267507, 209.        ],
        [ 97.        , 137.        ,   2.25941123, 103.        ],
        [ 97.        , 138.        ,   2.33989393,  14.        ],
        [ 97.        , 139.        ,   2.39913777,   1.        ],
        [ 98.        , 132.        ,   2.39913777,   1.        ],
        [ 98.        , 134.        ,   2.35763525,  10.        ],
        [ 98.        , 135.        ,   2.27390924,  45.        ],
        [ 98.        , 136.        ,   2.29335242,  29.        ],
        [ 98.        , 137.        ,   2.32060464,  19.        ],
        [ 99.        , 133.        ,   2.39913777,   1.        ],
        [ 97.        , 136.        ,   2.25215138, 222.        ],
        [ 99.        , 136.        ,   2.38590004,   4.        ],
        [ 95.        , 139.        ,   2.39486689,   2.        ],
        [ 95.        , 138.        ,   2.30798936,  23.        ],
        [ 92.        , 135.        ,   2.39055877,   3.        ],
        [ 92.        , 136.        ,   2.39913777,   1.        ],
        [ 93.        , 133.        ,   2.39486689,   2.        ],
        [ 93.        , 134.        ,   2.35763525,  10.        ],
        [ 93.        , 135.        ,   2.29335242,  29.        ],
        [ 93.        , 136.        ,   2.28963934,  31.        ],
        [ 93.        , 137.        ,   2.34413681,  13.        ],
        [ 93.        , 138.        ,   2.39486689,   2.        ],
        [ 93.        , 139.        ,   2.39913777,   1.        ],
        [ 94.        , 132.        ,   2.39913777,   1.        ],
        [ 94.        , 133.        ,   2.34857558,  12.        ],
        [ 94.        , 134.        ,   2.26067468,  94.        ],
        [ 94.        , 135.        ,   2.25087519, 248.        ],
        [ 94.        , 136.        ,   2.25164993, 232.        ],
        [ 94.        , 137.        ,   2.26188827,  87.        ],
        [ 94.        , 138.        ,   2.30798936,  23.        ],
        [ 95.        , 132.        ,   2.39486689,   2.        ],
        [ 95.        , 134.        ,   2.25138821, 237.        ],
        [ 95.        , 135.        ,   2.24114627, 559.        ],
        [ 95.        , 136.        ,   2.24190751, 535.        ],
        [ 95.        , 137.        ,   2.25133684, 238.        ],
        [ 99.        , 135.        ,   2.39055877,   3.        ],
        [ 96.        , 132.        ,   2.39055877,   3.        ],
        [ 95.        , 133.        ,   2.29768512,  27.        ],
        [114.        , 206.        ,   2.27355964,  57.        ],
        [107.        , 200.        ,   2.33279485,  17.        ],
        [107.        , 199.        ,   2.34064881,  15.        ],
        [107.        , 198.        ,   2.39076724,   4.        ],
        [107.        , 197.        ,   2.39542597,   3.        ],
        [106.        , 205.        ,   2.40400497,   1.        ],
        [106.        , 204.        ,   2.39542597,   3.        ],
        [106.        , 203.        ,   2.39076724,   4.        ],
        [106.        , 202.        ,   2.39076724,   4.        ],
        [106.        , 201.        ,   2.37663109,   7.        ],
        [106.        , 200.        ,   2.39542597,   3.        ],
        [106.        , 199.        ,   2.39973409,   2.        ],
        [105.        , 204.        ,   2.40400497,   1.        ],
        [105.        , 203.        ,   2.40400497,   1.        ],
        [107.        , 201.        ,   2.31578013,  22.        ],
        [105.        , 202.        ,   2.40400497,   1.        ],
        [192.        , 171.        ,   2.40400497,   1.        ],
        [191.        , 172.        ,   2.39973409,   2.        ],
        [191.        , 171.        ,   2.40400497,   1.        ],
        [191.        , 170.        ,   2.40400497,   1.        ],
        [190.        , 176.        ,   2.40400497,   1.        ],
        [190.        , 175.        ,   2.39076724,   4.        ],
        [190.        , 174.        ,   2.39973409,   2.        ],
        [190.        , 173.        ,   2.38610851,   5.        ],
        [190.        , 172.        ,   2.38139849,   6.        ],
        [190.        , 171.        ,   2.38610851,   5.        ],
        [190.        , 170.        ,   2.36717594,   9.        ],
        [190.        , 168.        ,   2.40400497,   1.        ],
        [189.        , 176.        ,   2.39076724,   4.        ],
        [105.        , 201.        ,   2.39542597,   3.        ],
        [107.        , 202.        ,   2.32547184,  19.        ],
        [107.        , 203.        ,   2.31578013,  22.        ],
        [107.        , 204.        ,   2.37663109,   7.        ],
        [110.        , 196.        ,   2.33653649,  16.        ],
        [110.        , 195.        ,   2.39542597,   3.        ],
        [109.        , 207.        ,   2.39542597,   3.        ],
        [109.        , 206.        ,   2.31578013,  22.        ],
        [109.        , 205.        ,   2.27568781,  51.        ],
        [109.        , 204.        ,   2.26897527,  76.        ],
        [109.        , 203.        ,   2.26014293, 157.        ],
        [109.        , 202.        ,   2.25595835, 243.        ],
        [109.        , 201.        ,   2.2543871 , 295.        ],
        [109.        , 200.        ,   2.25476772, 283.        ],
        [109.        , 199.        ,   2.25435538, 296.        ],
        [109.        , 198.        ,   2.25710993, 220.        ],
        [109.        , 197.        ,   2.34476113,  14.        ],
        [109.        , 196.        ,   2.38139849,   6.        ],
        [108.        , 206.        ,   2.35344278,  12.        ],
        [108.        , 205.        ,   2.31578013,  22.        ],
        [108.        , 204.        ,   2.28093   ,  42.        ],
        [108.        , 203.        ,   2.2727015 ,  60.        ],
        [108.        , 202.        ,   2.26453037, 101.        ],
        [108.        , 201.        ,   2.26404425, 105.        ],
        [108.        , 200.        ,   2.26427843, 103.        ],
        [108.        , 199.        ,   2.28093   ,  42.        ],
        [108.        , 198.        ,   2.33279485,  17.        ],
        [108.        , 197.        ,   2.39542597,   3.        ],
        [108.        , 196.        ,   2.38610851,   5.        ],
        [108.        , 195.        ,   2.39973409,   2.        ],
        [107.        , 207.        ,   2.40400497,   1.        ],
        [107.        , 206.        ,   2.39542597,   3.        ],
        [107.        , 205.        ,   2.38610851,   5.        ],
        [189.        , 175.        ,   2.38610851,   5.        ],
        [110.        , 197.        ,   2.28179379,  41.        ],
        [189.        , 174.        ,   2.36717594,   9.        ],
        [189.        , 172.        ,   2.34064881,  15.        ],
        [186.        , 175.        ,   2.26733024,  84.        ],
        [186.        , 174.        ,   2.2589502 , 174.        ],
        [186.        , 173.        ,   2.25457741, 289.        ],
        [186.        , 172.        ,   2.25169104, 380.        ],
        [186.        , 171.        ,   2.25261087, 351.        ],
        [186.        , 170.        ,   2.25467256, 286.        ],
        [186.        , 169.        ,   2.25962009, 164.        ],
        [186.        , 168.        ,   2.26855231,  78.        ],
        [186.        , 167.        ,   2.30490897,  26.        ],
        [186.        , 166.        ,   2.3290623 ,  18.        ],
        [186.        , 165.        ,   2.39542597,   3.        ],
        [186.        , 164.        ,   2.39973409,   2.        ],
        [185.        , 179.        ,   2.40400497,   1.        ],
        [186.        , 176.        ,   2.30038597,  28.        ],
        [185.        , 178.        ,   2.39542597,   3.        ],
        [185.        , 176.        ,   2.28093   ,  42.        ],
        [185.        , 175.        ,   2.26146907, 139.        ],
        [185.        , 174.        ,   2.25540195, 260.        ],
        [185.        , 173.        ,   2.24870952, 474.        ],
        [185.        , 172.        ,   2.24477645, 598.        ],
        [185.        , 171.        ,   2.2443324 , 612.        ],
        [185.        , 170.        ,   2.24893155, 467.        ],
        [185.        , 169.        ,   2.25483115, 281.        ],
        [185.        , 168.        ,   2.26212387, 129.        ],
        [185.        , 167.        ,   2.27453795,  54.        ],
        [185.        , 166.        ,   2.36250245,  10.        ] 
       ];
    
    let mut labels = vec![-1i32; data.len()];
    let mut image = [[-1i32; XYDIM + 6]; XYDIM + 6];

    let mut x:i32;
    let mut y:i32;
    let mut tof:f64;
    let mut tot:f64;
    let mut prev:usize;
    let mut i2:i32;
    let mut idx1:usize;
    let mut idx2:usize;
    let mut neighb_clusters = vec![1usize; 128];

    for i in 0..data.len() {
        x = data[i][0] as i32;
        y = data[i][1] as i32;
        tof = data[i][2];
        tot = data[i][3];

        labels[i] = i as i32;
        prev = i;
        neighb_clusters.clear();
        neighb_clusters.push(i);

        image[x as usize + 3][y as usize + 3] = i as i32;

        for (j, pos) in DELTA_POS.iter().enumerate() {
            idx1 = (x + pos.0 + 3) as usize;
            idx2 = (y + pos.1 + 3) as usize;
            i2 = image[idx1][idx2];

            // image is inititialized with -1
            if image[idx1][idx2] >= 0 {
                // Der Nachbarpunkt muss 0 bis < max_dist_tof Einheiten j√ºnger sein und eine h√∂here Intensit√§t aufweisen
                if (tof - data[i2 as usize][2]) < MAX_DIST_TOF && (tof - data[i2 as usize][2]) >= 0. && (data[i2 as usize][3] - tot) >= 0.0 {
                    // √ºbernehmen, wenn bisheriger Vorg√§nger in der Liste sp√§ter auftauchte
                    prev = min(prev, i2 as usize);
                }
                // Merken von Clusterzentren in der N√§he
                if (labels[i2 as usize] == i2) && (tof - data[i2 as usize][2] < MAX_DIST_TOF) {
                    neighb_clusters.push(i2 as usize);
                }
            }

            // determine if group in DELTA_POS is iterated and next group is about to start
            if j == 3 || j == 7 || j == 11 || j == 19 || j == 23 || j == 27 || j == 35 {
                if prev < i {
                    while labels[prev] != labels[labels[prev] as usize] {
                        labels[prev] = labels[labels[prev] as usize];
                    }
                    labels[i] = labels[prev];
                    break;
                }
            }

        }
        if prev == i {
            let mn = neighb_clusters
                .iter()
                .min().unwrap();
            for a in &neighb_clusters {
                labels[*a] = *mn as i32;
            }
        }


    }
    //println!("{:?}", labels.iter().map(|x| x+1).collect::<Vec<i32>>());
    labels.iter().map(|x| x+1).collect::<Vec<i32>>() 


}

fn main() {
    let mut buf = vec![];
    std::fs::File::open("tests/matlab_labels_500.npy").unwrap()
        .read_to_end(&mut buf).unwrap();

    let labels_matlab: NpyData<u16> = NpyData::from_bytes(&buf).unwrap();
    //for number in labels_matlab {
    //    eprintln!("{}", number);
    //}
    
    labels_matlab.to_vec();

    let labels = get_labels();
    //println!("{:?}", labels);
    for (i , label_m) in labels_matlab.into_iter().enumerate() {
        println!("{} {} {}", i, labels[i], labels[i] - label_m as i32);
    }
}
